<!DOCTYPE html>
<html>
<head>
      <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cuspotify</title>
  <link rel="stylesheet" type="text/css" href="http://cuspotify.co.vu/style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>
  <script>
    $(document).ready(function() {
    $.ajax({
      method: "POST"  
      url: "https://accounts.spotify.com/api/token"
    }).then(function(data) {
       $('.greeting-id').append(data.id);
       $('.greeting-content').append(data.content);
    });
});
  </script>
  <script src="oauth.js"></script>
  <script>
  $(document).ready(function(){
    OAuth.initialize('Xxg6VRsPp-9Fs6xwSwjEfjIqQtw')
  $(".sign-in").click(function(){
OAuth.popup('spotify').done(function(result) {
    console.log(result)
    // do some stuff with result
    console.log('Positive or Negative?', result)
});
});
});
</script>
  <script>
window.onSpotifyWebPlaybackSDKReady = () => {
$(document).ready(function(){
    // Get the hash of the url
const hash = window.location.hash
.substring(1)
.split('&')
.reduce(function (initial, item) {
  if (item) {
    var parts = item.split('=');
    initial[parts[0]] = decodeURIComponent(parts[1]);
  }
  return initial;
}, {});
window.location.hash = '';

// Set token
let _token = hash.access_token;

const authEndpoint = 'https://accounts.spotify.com/authorize';

// Replace with your app's client ID, redirect URI and desired scopes
const clientId = 'f49138eb3c684fd4af3dfc8f2b0474bb';
const redirectUri = 'http://cuspotify.co.vu';
const scopes = [
  'streaming',
  'user-read-birthdate',
  'user-read-private',
  'user-modify-playback-state',
  'streaming'
];

// If there is no token, redirect to Spotify authorization
if (!_token) {
  window.location = `${authEndpoint}?client_id=${clientId}&redirect_uri=${redirectUri}&scope=${scopes.join('%20')}&response_type=token&show_dialog=true`;
}
});
    $(".connect").click(function(){


// Set up the Web Playback SDK

window.onSpotifyPlayerAPIReady = () => {
  const player = new Spotify.Player({
    name: 'Spotify test',
    getOAuthToken: cb => { cb(_token); }
  });

  // Error handling
  player.addListener('initialization_error', ({ message }) => { console.error(message); });
  player.addListener('authentication_error', ({ message }) => { console.error(message); });
  player.addListener('account_error', ({ message }) => { console.error(message); });
  player.addListener('playback_error', ({ message }) => { console.error(message); });
  // Playback status updates
  player.addListener('player_state_changed', ({
  position,
  duration,
  track_window: { current_track }
}) => {
  console.log('Currently Playing', current_track);
  console.log('Position in Song', position);
  console.log('Duration of Song', duration);
});

  // Ready
  player.addListener('ready', ({ device_id }) => {
    console.log('Ready with Device ID', device_id);
  });

  // Not Ready
  player.addListener('not_ready', ({ device_id }) => {
    console.log('Device ID has gone offline', device_id);
  });

  // Connect to the player!
player.connect().then(success => {
  if (success) {
    console.log('The Web Playback SDK successfully connected to Spotify!');
  }
})
// Pause
 $(".pause").click(function(){
  player.togglePlay().then(() => {
});
});
$(".disconnect").click(function(){
player.disconnect().then(() => {
console.log('Disconnected');
})
});
 player.on('player_state_changed', state => {
    console.log(state)
    $('#info-pic').attr('src', state.track_window.current_track.album.images[0].url);
    $('#info').text(state.track_window.current_track.name);
  });
};
});
};
</script>
  <h1>Spotify Web Playback SDK Quick Start Tutorial</h1>
  <h2>Open your console log: <code>View > Developer > JavaScript Console</code></h2>

  <script src="https://sdk.scdn.co/spotify-player.js"></script> 
  <!-- We will insert our code here. -->
  <div class="connect button">Start Spotify Connect</div>
  <div class="disconnect button">Disconnect from Client</div>
  <div class="pause button">Play/pause</div>
  <div class="sign-in button">Sign in</div>
  <div class="notif button">Notif</div><br />
  <img id="info-pic"/>
  <p id="info"></p>
  <img class="logo" src="http://cuspotify.co.vu/logo-spotify.png" alt=""/>
</body>
</html>